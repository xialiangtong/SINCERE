<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>ConnectFour.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">sincere</a> &gt; <a href="index.source.html" class="el_package">default</a> &gt; <span class="el_source">ConnectFour.java</span></div><h1>ConnectFour.java</h1><pre class="source lang-java linenums">/**
 * Connect Four Game Engine
 * 
 * Implements the core rules for Connect Four with configurable board size.
 */
public class ConnectFour {

    /**
     * Represents a player or empty cell.
     */
<span class="nc" id="L11">    public enum Player {</span>
<span class="nc" id="L12">        NONE, PLAYER_1, PLAYER_2;</span>

        public Player opponent() {
<span class="nc bnc" id="L15" title="All 4 branches missed.">            return this == PLAYER_1 ? PLAYER_2 : (this == PLAYER_2 ? PLAYER_1 : NONE);</span>
        }

        @Override
        public String toString() {
<span class="nc bnc" id="L20" title="All 4 branches missed.">            return this == PLAYER_1 ? &quot;X&quot; : (this == PLAYER_2 ? &quot;O&quot; : &quot;.&quot;);</span>
        }
    }

    /**
     * Represents the game status.
     */
<span class="nc" id="L27">    public enum GameStatus {</span>
<span class="nc" id="L28">        IN_PROGRESS,</span>
<span class="nc" id="L29">        PLAYER_1_WINS,</span>
<span class="nc" id="L30">        PLAYER_2_WINS,</span>
<span class="nc" id="L31">        DRAW</span>
    }

    /**
     * Result of a move attempt.
     */
<span class="nc" id="L37">    public enum MoveResult {</span>
<span class="nc" id="L38">        SUCCESS,</span>
<span class="nc" id="L39">        INVALID_COLUMN,</span>
<span class="nc" id="L40">        COLUMN_FULL,</span>
<span class="nc" id="L41">        GAME_OVER</span>
    }

    /**
     * Result containing move outcome and updated game state.
     */
    public static class DropResult {
        private final MoveResult result;
        private final int row;  // Row where disc landed (-1 if failed)
        private final GameStatus status;

<span class="nc" id="L52">        private DropResult(MoveResult result, int row, GameStatus status) {</span>
<span class="nc" id="L53">            this.result = result;</span>
<span class="nc" id="L54">            this.row = row;</span>
<span class="nc" id="L55">            this.status = status;</span>
<span class="nc" id="L56">        }</span>

        public static DropResult success(int row, GameStatus status) {
<span class="nc" id="L59">            return new DropResult(MoveResult.SUCCESS, row, status);</span>
        }

        public static DropResult failure(MoveResult result, GameStatus status) {
<span class="nc" id="L63">            return new DropResult(result, -1, status);</span>
        }

<span class="nc" id="L66">        public MoveResult getResult() { return result; }</span>
<span class="nc" id="L67">        public int getRow() { return row; }</span>
<span class="nc" id="L68">        public GameStatus getStatus() { return status; }</span>
<span class="nc bnc" id="L69" title="All 2 branches missed.">        public boolean isSuccess() { return result == MoveResult.SUCCESS; }</span>

        @Override
        public String toString() {
<span class="nc" id="L73">            return &quot;DropResult{result=&quot; + result + &quot;, row=&quot; + row + &quot;, status=&quot; + status + &quot;}&quot;;</span>
        }
    }

    // Board configuration
    private final int width;
    private final int height;
    private final int winLength;

    // Game state
    private final Player[][] board;
    private Player currentPlayer;
    private GameStatus status;
    private int movesCount;

    /**
     * Creates a new Connect Four game with default 7x6 board.
     */
    public ConnectFour() {
<span class="nc" id="L92">        this(7, 6, 4);</span>
<span class="nc" id="L93">    }</span>

    /**
     * Creates a new Connect Four game with custom dimensions.
     */
<span class="nc" id="L98">    public ConnectFour(int width, int height, int winLength) {</span>
<span class="nc" id="L99">        this.width = width;</span>
<span class="nc" id="L100">        this.height = height;</span>
<span class="nc" id="L101">        this.winLength = winLength;</span>
<span class="nc" id="L102">        this.board = new Player[height][width];</span>
<span class="nc" id="L103">        reset();</span>
<span class="nc" id="L104">    }</span>

    /**
     * Resets the game to initial state.
     */
    public void reset() {
<span class="nc bnc" id="L110" title="All 2 branches missed.">        for (int row = 0; row &lt; height; row++) {</span>
<span class="nc bnc" id="L111" title="All 2 branches missed.">            for (int col = 0; col &lt; width; col++) {</span>
<span class="nc" id="L112">                board[row][col] = Player.NONE;</span>
            }
        }
<span class="nc" id="L115">        currentPlayer = Player.PLAYER_1;</span>
<span class="nc" id="L116">        status = GameStatus.IN_PROGRESS;</span>
<span class="nc" id="L117">        movesCount = 0;</span>
<span class="nc" id="L118">    }</span>

    /**
     * Drops a disc into the specified column.
     * @param column Column index (0-based)
     * @return DropResult with outcome
     */
    public DropResult dropDisc(int column) {
        // Check if game is already over
<span class="nc bnc" id="L127" title="All 2 branches missed.">        if (status != GameStatus.IN_PROGRESS) {</span>
<span class="nc" id="L128">            return DropResult.failure(MoveResult.GAME_OVER, status);</span>
        }

        // Validate column index
<span class="nc bnc" id="L132" title="All 4 branches missed.">        if (column &lt; 0 || column &gt;= width) {</span>
<span class="nc" id="L133">            return DropResult.failure(MoveResult.INVALID_COLUMN, status);</span>
        }

        // Check if column is full (top row is filled)
<span class="nc bnc" id="L137" title="All 2 branches missed.">        if (board[0][column] != Player.NONE) {</span>
<span class="nc" id="L138">            return DropResult.failure(MoveResult.COLUMN_FULL, status);</span>
        }

        // Find the lowest empty row in the column
<span class="nc" id="L142">        int row = findLowestEmptyRow(column);</span>
<span class="nc" id="L143">        board[row][column] = currentPlayer;</span>
<span class="nc" id="L144">        movesCount++;</span>

        // Check for win
<span class="nc bnc" id="L147" title="All 2 branches missed.">        if (checkWin(row, column)) {</span>
<span class="nc bnc" id="L148" title="All 2 branches missed.">            status = (currentPlayer == Player.PLAYER_1) ? </span>
<span class="nc" id="L149">                     GameStatus.PLAYER_1_WINS : GameStatus.PLAYER_2_WINS;</span>
<span class="nc" id="L150">            return DropResult.success(row, status);</span>
        }

        // Check for draw
<span class="nc bnc" id="L154" title="All 2 branches missed.">        if (movesCount == width * height) {</span>
<span class="nc" id="L155">            status = GameStatus.DRAW;</span>
<span class="nc" id="L156">            return DropResult.success(row, status);</span>
        }

        // Switch player
<span class="nc" id="L160">        currentPlayer = currentPlayer.opponent();</span>
<span class="nc" id="L161">        return DropResult.success(row, status);</span>
    }

    /**
     * Finds the lowest empty row in a column.
     */
    private int findLowestEmptyRow(int column) {
<span class="nc bnc" id="L168" title="All 2 branches missed.">        for (int row = height - 1; row &gt;= 0; row--) {</span>
<span class="nc bnc" id="L169" title="All 2 branches missed.">            if (board[row][column] == Player.NONE) {</span>
<span class="nc" id="L170">                return row;</span>
            }
        }
<span class="nc" id="L173">        return -1; // Should never reach here if column is not full</span>
    }

    /**
     * Checks if the last move at (row, col) resulted in a win.
     * Efficiently checks only the four directions from the last move.
     */
    private boolean checkWin(int row, int col) {
<span class="nc" id="L181">        Player player = board[row][col];</span>
        
        // Check all four directions: horizontal, vertical, two diagonals
<span class="nc bnc" id="L184" title="All 2 branches missed.">        return countDirection(row, col, 0, 1, player) &gt;= winLength ||  // Horizontal</span>
<span class="nc bnc" id="L185" title="All 2 branches missed.">               countDirection(row, col, 1, 0, player) &gt;= winLength ||  // Vertical</span>
<span class="nc bnc" id="L186" title="All 2 branches missed.">               countDirection(row, col, 1, 1, player) &gt;= winLength ||  // Diagonal \</span>
<span class="nc bnc" id="L187" title="All 2 branches missed.">               countDirection(row, col, 1, -1, player) &gt;= winLength;   // Diagonal /</span>
    }

    /**
     * Counts consecutive pieces in a direction (both ways from the position).
     */
    private int countDirection(int row, int col, int dRow, int dCol, Player player) {
<span class="nc" id="L194">        int count = 1; // Count the piece at (row, col)</span>
        
        // Count in positive direction
<span class="nc" id="L197">        count += countInDirection(row, col, dRow, dCol, player);</span>
        
        // Count in negative direction
<span class="nc" id="L200">        count += countInDirection(row, col, -dRow, -dCol, player);</span>
        
<span class="nc" id="L202">        return count;</span>
    }

    /**
     * Counts consecutive pieces in one direction.
     */
    private int countInDirection(int row, int col, int dRow, int dCol, Player player) {
<span class="nc" id="L209">        int count = 0;</span>
<span class="nc" id="L210">        int r = row + dRow;</span>
<span class="nc" id="L211">        int c = col + dCol;</span>
        
<span class="nc bnc" id="L213" title="All 10 branches missed.">        while (r &gt;= 0 &amp;&amp; r &lt; height &amp;&amp; c &gt;= 0 &amp;&amp; c &lt; width &amp;&amp; board[r][c] == player) {</span>
<span class="nc" id="L214">            count++;</span>
<span class="nc" id="L215">            r += dRow;</span>
<span class="nc" id="L216">            c += dCol;</span>
        }
        
<span class="nc" id="L219">        return count;</span>
    }

    /**
     * Gets the cell value at the specified position.
     * Row 0 is the top row.
     */
    public Player getCell(int row, int col) {
<span class="nc bnc" id="L227" title="All 8 branches missed.">        if (row &lt; 0 || row &gt;= height || col &lt; 0 || col &gt;= width) {</span>
<span class="nc" id="L228">            return null;</span>
        }
<span class="nc" id="L230">        return board[row][col];</span>
    }

    /**
     * Gets the current game status.
     */
    public GameStatus getStatus() {
<span class="nc" id="L237">        return status;</span>
    }

    /**
     * Gets the current player.
     */
    public Player getCurrentPlayer() {
<span class="nc" id="L244">        return currentPlayer;</span>
    }

    /**
     * Gets the board width.
     */
    public int getWidth() {
<span class="nc" id="L251">        return width;</span>
    }

    /**
     * Gets the board height.
     */
    public int getHeight() {
<span class="nc" id="L258">        return height;</span>
    }

    /**
     * Checks if the game is over.
     */
    public boolean isGameOver() {
<span class="nc bnc" id="L265" title="All 2 branches missed.">        return status != GameStatus.IN_PROGRESS;</span>
    }

    /**
     * Gets a string representation of the board.
     */
    public String getBoardString() {
<span class="nc" id="L272">        StringBuilder sb = new StringBuilder();</span>
        
        // Column numbers
<span class="nc bnc" id="L275" title="All 2 branches missed.">        for (int col = 0; col &lt; width; col++) {</span>
<span class="nc" id="L276">            sb.append(&quot; &quot;).append(col);</span>
        }
<span class="nc" id="L278">        sb.append(&quot;\n&quot;);</span>
        
        // Board
<span class="nc bnc" id="L281" title="All 2 branches missed.">        for (int row = 0; row &lt; height; row++) {</span>
<span class="nc bnc" id="L282" title="All 2 branches missed.">            for (int col = 0; col &lt; width; col++) {</span>
<span class="nc" id="L283">                sb.append(&quot;|&quot;).append(board[row][col]);</span>
            }
<span class="nc" id="L285">            sb.append(&quot;|\n&quot;);</span>
        }
        
        // Bottom border
<span class="nc" id="L289">        sb.append(&quot;-&quot;.repeat(width * 2 + 1));</span>
        
<span class="nc" id="L291">        return sb.toString();</span>
    }

    /**
     * Factory method to create a new game.
     */
    public static ConnectFour newGame() {
<span class="nc" id="L298">        return new ConnectFour();</span>
    }

    /**
     * Factory method to create a new game with custom dimensions.
     */
    public static ConnectFour newGame(int width, int height) {
<span class="nc" id="L305">        return new ConnectFour(width, height, 4);</span>
    }

    public static void main(String[] args) {
<span class="nc" id="L309">        ConnectFour game = ConnectFour.newGame();</span>
        
<span class="nc" id="L311">        System.out.println(&quot;=== Connect Four Demo ===\n&quot;);</span>
<span class="nc" id="L312">        System.out.println(game.getBoardString());</span>
        
        // Simulate a game
<span class="nc" id="L315">        int[] moves = {3, 3, 4, 4, 5, 5, 6}; // Player 1 wins horizontally</span>
        
<span class="nc bnc" id="L317" title="All 2 branches missed.">        for (int col : moves) {</span>
<span class="nc" id="L318">            System.out.println(&quot;\n&quot; + game.getCurrentPlayer() + &quot; drops in column &quot; + col);</span>
<span class="nc" id="L319">            DropResult result = game.dropDisc(col);</span>
<span class="nc" id="L320">            System.out.println(&quot;Result: &quot; + result);</span>
<span class="nc" id="L321">            System.out.println(game.getBoardString());</span>
            
<span class="nc bnc" id="L323" title="All 2 branches missed.">            if (game.isGameOver()) {</span>
<span class="nc" id="L324">                System.out.println(&quot;\nGame Over! Status: &quot; + game.getStatus());</span>
<span class="nc" id="L325">                break;</span>
            }
        }
        
        // Test error cases
<span class="nc" id="L330">        System.out.println(&quot;\n=== Error Cases ===&quot;);</span>
        
        // Try to play after game is over
<span class="nc" id="L333">        DropResult afterGame = game.dropDisc(0);</span>
<span class="nc" id="L334">        System.out.println(&quot;Move after game over: &quot; + afterGame);</span>
        
        // Test with new game
<span class="nc" id="L337">        game.reset();</span>
<span class="nc" id="L338">        System.out.println(&quot;\n=== New Game - Testing Errors ===&quot;);</span>
        
        // Invalid column
<span class="nc" id="L341">        DropResult invalid = game.dropDisc(-1);</span>
<span class="nc" id="L342">        System.out.println(&quot;Invalid column (-1): &quot; + invalid);</span>
        
<span class="nc" id="L344">        invalid = game.dropDisc(7);</span>
<span class="nc" id="L345">        System.out.println(&quot;Invalid column (7): &quot; + invalid);</span>
        
        // Fill a column and try to add more
<span class="nc" id="L348">        System.out.println(&quot;\nFilling column 0...&quot;);</span>
<span class="nc bnc" id="L349" title="All 2 branches missed.">        for (int i = 0; i &lt; 6; i++) {</span>
<span class="nc" id="L350">            game.dropDisc(0);</span>
<span class="nc" id="L351">            game.dropDisc(1); // Alternate to avoid winning</span>
        }
<span class="nc" id="L353">        DropResult full = game.dropDisc(0);</span>
<span class="nc" id="L354">        System.out.println(&quot;Column full: &quot; + full);</span>
<span class="nc" id="L355">    }</span>
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.10.202304240956</span></div></body></html>